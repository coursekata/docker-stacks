---
name: Publish images

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - .github/workflows/publish.yml
      - .github/workflows/build-test-publish-all.yml
      - .github/actions/build-test-push/**
      - tests/**
      - base-r-notebook/**
      - essentials-notebook/**
      - r-notebook/**
      - datascience-notebook/**
  schedule:
    # Weekly, at 03:00 on Monday UTC time (see https://crontab.guru)
    - cron: "0 3 * * 1"

# https://docs.github.com/en/actions/using-jobs/using-concurrency
concurrency:
  # only cancel in-progress jobs or runs for the current workflow - matches against branch & tags
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  publish:
    uses: ./.github/workflows/build-test-publish-all.yml
    secrets: inherit
    with:
      publish: true
      base-image: jupyter/minimal-notebook
      python-version: "3.11"
      r-version: "4.3"
      tags: |
        type=raw,value=python-3.11
        type=raw,value=r-4.3
